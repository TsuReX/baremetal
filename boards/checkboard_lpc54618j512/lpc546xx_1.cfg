source [find target/swj-dp.tcl]
source [find mem_helper.tcl]

adapter_khz 4000

set _CHIPNAME lpc546xx
set _WORKAREASIZE 0x2000

if {[using_swd]} {
	set _TAPID 0x2ba01477
	swd newdap $_CHIPNAME cpu -expected-id $_TAPID
}

if {[using_jtag]} {
	set _TAPID 0x10caa02b
	jtag newtap $_CHIPNAME cpu -irlen 5 -expected-id $_TAPID
}

target create $_CHIPNAME.cpu cortex_m -chain-position $_CHIPNAME.cpu

$_CHIPNAME.cpu configure -work-area-phys 0x20000000 \
							-work-area-size $_WORKAREASIZE -work-area-backup 0

set BASE_ADDR	0x0
set SIZE	0x40000 ;# 512Kb

flash bank $_CHIPNAME.flash lpc2000 0 0x80000 0 0 $_CHIPNAME.cpu lpc54100 204000

$_CHIPNAME.cpu configure -event examine-end {

	echo !!!examine-end!!!
}

$_CHIPNAME.cpu configure -event trace-config {

	echo !!trace-config!!
}

$_CHIPNAME.cpu configure -event reset-init {

	echo !!!reset-init!!!
}

$_CHIPNAME.cpu configure -event reset-start {

	echo !!!reset-start!!!
}

#cortex_m reset_config vectreset

proc user_disp_flash { } {
	mdw 0x00000000 0x10
}

add_usage_text user_disp_flash "No arguments"
add_help_text user_disp_flash "Displaying first 16 words of flash."

proc user_prog_flash {path_file} {
	flash write_image erase $path_file
}

add_usage_text user_prog_flash "Path to image file."
add_help_text user_prog_flash "Displaying first 16 words of flash."

proc user_read_flash {} {
	flash read_bank 0 lpc546xx.flash.bank0
}

targets


